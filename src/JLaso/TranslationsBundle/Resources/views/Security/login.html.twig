{% extends '::base.html.twig' %}

{% block stylesheets %}
<style type="text/css">
    body {
        padding-top: 160px;
        padding-bottom: 40px;
        background-image: url("{{ asset('bundles/translations/resource/img/bg.png') }}");
    }

    .sidebar-nav {
        padding: 9px 0;
    }
</style>
{% endblock stylesheets %}

{% block body %}
    <div class="container">

        <div class="row">

            <div class="span4 offset4">
                <div class="navbar">
                    <div class="navbar-inner">
                        <div class="container">
                            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </a>
                            <a class="brand" href="{{ path('home') }}" style="color: #ffffff;">
                                <img src="{{ asset('logo-translations-white.png') }}" height="42" alt=""/>&nbsp;
                                {{ "login.title"|trans|raw }}
                            </a>

                            <div class="nav-collapse pull-right">
                                {% include ':Languages:languages-select.html.twig' %}
                            </div>
                            <!-- /.nav-collapse -->
                        </div>
                    </div>
                    <!-- /navbar-inner -->
                </div>

                <form class="well" action="{{ path('user_login_check') }}" novalidate  method="post">
                    <div class="input-prepend">
                        <div class="error">{{ error is not null ? error.message : '' }}</div>
                        <span class="add-on"><i class="icon-envelope"></i></span>
                        <input class="span2" type="text"
                               id="_username" name="_username" value="{{ last_username }}"
                               placeholder="{{ "login.placeholder.email"|trans|raw }}">
                    </div>
                    <div class="input-prepend">
                        <span class="add-on"><i class="icon-key"></i></span>
                        <input class="span2" type="password"
                               id="_password" name="_password" placeholder="{{ "login.placeholder.password"|trans|raw }}">
                    </div>
                    <br />

                    <div class="container">
                        <div class="row">
                            <div class="span3">
                                <button class="btn btn-danger">{{ "login.login_button"|trans|raw }}</button>
                                <button class="btn pull-right" id="login_github">{{ "login.login_with_github"|trans|raw }}</button>
                            </div>
                            <div class="span12">&nbsp;</div>
                            <div class="span12">
                                <span>{{ "login.not_a_member_yet"|trans|raw }}
                                    <a href="{{ url('user_register') }}">
                                        {{ "login.register"|trans|raw }}
                                    </a>
                                </span>
                            </div>
                        </div>
                    </div>

                </form>
            </div>

        </div>

    </div>
{% endblock body %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        $(function(){
            $('#login_github').click(function (e) {
                e.preventDefault();
                window.location = 'https://github.com/login/oauth/authorize?client_id={{ client_id }}';
            });
        });

        {#window.addEventListener('message', function (event) {#}
            {#var code = event.data;#}
            {#var url = '{{ path('do_github_login') }}?code=' + code;#}
            {#console.log(url);#}
            {#$.get(url, function (result) {#}
                {#if(result == 'OK'){#}
                    {#if(confirm('{{ path('user_index') }}')){#}
                        {#window.location = '{{ path('user_index') }}';#}
                    {#}#}
                {#}else{#}
                    {#alert('error, result is ' + result);#}
                {#}#}
            {#});#}
        {#});#}

    </script>
{% endblock javascripts %}
